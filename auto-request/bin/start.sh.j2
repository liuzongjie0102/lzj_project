#!/bin/bash

APP_NAME=edc-plsqltool-ms
APP_VERSION=1.0.0
APP_ENV=${appenv:-dev}
LOG_MAX_SIZE={{ comm_log_max_size }}
XMX_SIZE={{ edc_plsqltool_ms_xmx_size }}

JAVA_HOME={{ jdk8_home }}

# change directory to program dir
FWDIR="$(cd `dirname $0`/..; pwd)"
cd ${FWDIR}

if [ ! -d ${FWDIR}/java.pid ]; then
    touch ${FWDIR}/java.pid
fi

OSUSER=$(id -nu)
PSNUM=$(cat ${FWDIR}/java.pid)
if [[ "$PSNUM" -ne "" ]]; then
    echo ${APP_NAME}" has been started! stop first."
    exit;
fi

${JAVA_HOME}/bin/java -Xmx${XMX_SIZE} -Dfile.encoding=utf-8 -Dspring.profiles.active=${APP_ENV} -Dapp.name=${APP_NAME} -Dapp.env=${APP_ENV} -Dmax.size=${LOG_MAX_SIZE} -Duser.dir=${FWDIR} -jar ${APP_NAME}-${APP_VERSION}.jar >/dev/null 2>&1 &
echo $! > ${FWDIR}/java.pid
exit
